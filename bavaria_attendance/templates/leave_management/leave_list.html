{% extends 'base.html' %}

{% block title %}Leave Management - Bavaria Garments{% endblock %}
{% block page_title %}Leave Management{% endblock %}

{% block extra_css %}
<style>
    .header-text {
        color: #1e3a5f;
        font-weight: 600;
    }
    .status-badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-weight: 500;
        font-size: 0.85rem;
    }
    .status-approved {
        background: rgba(56, 161, 105, 0.1);
        color: #38a169;
    }
    .status-rejected {
        background: rgba(229, 62, 62, 0.1);
        color: #e53e3e;
    }
    .status-pending {
        background: rgba(214, 158, 46, 0.1);
        color: #d69e2e;
    }
    .leave-type-badge {
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 500;
    }
    .action-btn {
        width: 34px;
        height: 34px;
        border-radius: 8px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
    }
    .action-btn:hover {
        transform: translateY(-2px);
    }
</style>
{% endblock %}

{% block content %}
<div class="filter-section">
    <form method="get" class="row g-3">
        <div class="col-md-3">
            <select name="employee" class="form-select">
                <option value="">All Employees</option>
                {% for emp in employees %}
                <option value="{{ emp.id }}" {% if request.GET.employee == emp.id|stringformat:"s" %}selected{% endif %}>
                    {{ emp.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <select name="leave_type" class="form-select">
                <option value="">All Types</option>
                <option value="SL">Sick Leave</option>
                <option value="CL">Casual Leave</option>
                <option value="PL">Privilege Leave</option>
                <option value="ML">Maternity Leave</option>
                <option value="LWP">Leave Without Pay</option>
                <option value="WL">Wedding Leave</option>
            </select>
        </div>
        <div class="col-md-2">
            <select name="status" class="form-select">
                <option value="">All Status</option>
                <option value="pending">Pending</option>
                <option value="approved">Approved</option>
                <option value="rejected">Rejected</option>
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100"><i class="fas fa-filter me-2"></i>Filter</button>
        </div>
        <div class="col-md-3">
            {% if user.is_admin or user.is_hr %}
            <a href="{% url 'leave:leave_create' %}" class="btn btn-primary w-100">
                <i class="fas fa-plus me-2"></i>Add Leave
            </a>
            {% endif %}
        </div>
    </form>
</div>

<div class="card">
    <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0 header-text"><i class="fas fa-calendar-minus me-2"></i>Leave Requests</h5>
        <span class="badge bg-light text-dark fs-6">
            <i class="fas fa-list me-1"></i> {{ leaves|length }} Records
        </span>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th><i class="fas fa-calendar me-2"></i>Date</th>
                        <th><i class="fas fa-user me-2"></i>Employee</th>
                        <th><i class="fas fa-tags me-2"></i>Leave Type</th>
                        <th><i class="fas fa-comment me-2"></i>Reason</th>
                        <th><i class="fas fa-toggle-on me-2"></i>Status</th>
                        {% if user.is_admin or user.is_hr %}
                        <th><i class="fas fa-cogs me-2"></i>Actions</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for leave in leaves %}
                    <tr>
                        <td><span class="fw-bold">{{ leave.date }}</span></td>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="employee-avatar-sm me-2" style="width:32px;height:32px;background:#1e3a5f;border-radius:8px;display:flex;align-items:center;justify-content:center;color:white;font-weight:600;font-size:0.8rem;">
                                    {{ leave.employee.name|make_list|first|upper }}
                                </div>
                                {{ leave.employee.name }}
                            </div>
                        </td>
                        <td>
                            {% if leave.leave_type == 'SL' %}
                            <span class="leave-type-badge bg-info text-white">Sick Leave</span>
                            {% elif leave.leave_type == 'CL' %}
                            <span class="leave-type-badge bg-success text-white">Casual Leave</span>
                            {% elif leave.leave_type == 'PL' %}
                            <span class="leave-type-badge bg-primary text-white">Privilege Leave</span>
                            {% elif leave.leave_type == 'ML' %}
                            <span class="leave-type-badge bg-warning text-white">Maternity Leave</span>
                            {% elif leave.leave_type == 'LWP' %}
                            <span class="leave-type-badge bg-danger text-white">Leave Without Pay</span>
                            {% elif leave.leave_type == 'WL' %}
                            <span class="leave-type-badge bg-secondary text-white">Wedding Leave</span>
                            {% endif %}
                        </td>
                        <td>{{ leave.reason|truncatechars:30 }}</td>
                        <td>
                            {% if leave.status == 'approved' %}
                            <span class="badge status-badge status-approved">
                                <i class="fas fa-check-circle me-1"></i> Approved
                            </span>
                            {% elif leave.status == 'rejected' %}
                            <span class="badge status-badge status-rejected">
                                <i class="fas fa-times-circle me-1"></i> Rejected
                            </span>
                            {% else %}
                            <span class="badge status-badge status-pending">
                                <i class="fas fa-clock me-1"></i> Pending
                            </span>
                            {% endif %}
                        </td>
                        {% if user.is_admin or user.is_hr %}
                        <td>
                            <a href="{% url 'leave:leave_update' leave.pk %}" class="btn action-btn btn-warning text-white" title="Edit">
                                <i class="fas fa-edit"></i>
                            </a>
                        </td>
                        {% endif %}
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="{% if user.is_admin or user.is_hr %}6{% else %}5{% endif %}" class="text-center py-5">
                            <div class="text-muted">
                                <i class="fas fa-calendar-minus fa-3x mb-3 d-block" style="color: #cbd5e0;"></i>
                                <p class="mb-0">No leave records found.</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
